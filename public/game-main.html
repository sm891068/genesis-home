<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘é“å»ºç¯‰ Underworld Architect - éŠæˆ²ä¸»ç•«é¢</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --gold: #d4af37;
            --gold-light: #f4d03f;
            --gold-dark: #b8941f;
            --gold-glow: rgba(212, 175, 55, 0.3);
            --red: #ff2e63;
            --blue: #3498db;
            --purple: #9b59b6;
            --green: #27ae60;
            --bg: #0a0e27;
            --bg-light: #151a35;
            --panel: rgba(10, 14, 39, 0.98);
            --text: #e8e8e8;
            --gray: #888;
            --border: rgba(212, 175, 55, 0.2);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            font-size: 14px;
        }
        
        /* ========== å‹•ç•« ========== */
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideUpPanel { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes slideDownPanel { from { transform: translateY(0); } to { transform: translateY(100%); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 20px var(--gold-glow); } 50% { box-shadow: 0 0 40px var(--gold-glow), 0 0 60px rgba(212, 175, 55, 0.1); } }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        
        .gold-text { color: var(--gold); text-shadow: 0 0 10px rgba(212,175,55,0.3); }
        
        /* ========== éŠæˆ²ä¸»ç•«é¢ ========== */
        #game-screen {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
            inset: 0;
            z-index: 100;
        }
        
        /* é ‚éƒ¨é ­æ¢æ¬„ */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            height: 56px;
            background: rgba(0,0,0,0.5);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }
        
        .res-box {
            display: flex;
            gap: 28px;
        }
        
        .res-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 80px;
        }
        
        .res-item .label {
            font-size: 9px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .res-item .value {
            font-size: 18px;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(212,175,55,0.3);
        }
        
        .day-box {
            font-size: 13px;
            color: var(--gray);
            background: rgba(212,175,55,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border);
            font-weight: 500;
            text-align: center;
        }
        
        .day-box span { color: var(--gold); font-weight: 700; font-size: 15px; }
        
        .header-btns {
            display: flex;
            gap: 8px;
        }
        
        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            color: var(--gray);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-btn:hover {
            color: var(--gold);
            border-color: var(--gold);
            background: rgba(212,175,55,0.1);
            transform: translateY(-2px);
        }
        
        /* åœ°åœ–å®¹å™¨ */
        .map-container {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            overflow-x: hidden;
            background: radial-gradient(ellipse at center, rgba(212,175,55,0.03) 0%, transparent 70%);
        }
        
        .map-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }
        
        .grid-cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 55px;
        }
        
        .grid-cell:hover {
            background: rgba(212,175,55,0.15);
            border-color: var(--gold);
            transform: scale(0.95);
            box-shadow: 0 0 20px rgba(212,175,55,0.2);
        }
        
        .grid-cell.hq {
            border-color: var(--gold);
            border-width: 2px;
            background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.05));
            box-shadow: 0 0 20px rgba(212,175,55,0.3);
            animation: glow 3s ease-in-out infinite;
        }
        
        .grid-cell .lv {
            position: absolute;
            bottom: 4px;
            right: 6px;
            font-size: 9px;
            color: var(--gold);
            background: rgba(0,0,0,0.7);
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: 700;
        }
        
        /* ========== åº•éƒ¨åŠŸèƒ½æ¬„ï¼ˆDesktop - å§‹çµ‚å¯è¦‹ï¼‰========== */
        .game-footer {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 8px 12px;
            height: 70px;
            background: rgba(0,0,0,0.7);
            border-top: 1px solid var(--border);
            backdrop-filter: blur(10px);
            gap: 4px;
            overflow-x: auto;
            flex-shrink: 0;
            z-index: 99;
        }
        
        .game-footer::-webkit-scrollbar {
            height: 4px;
        }
        
        .game-footer::-webkit-scrollbar-thumb {
            background: rgba(212,175,55,0.3);
            border-radius: 2px;
        }
        
        /* åŠŸèƒ½æŒ‰éˆ• */
        .foot-btn {
            background: transparent;
            border: none;
            color: var(--gray);
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 8px 10px;
            position: relative;
            transition: all 0.3s;
            border-radius: 12px;
            min-width: 70px;
            flex-shrink: 0;
            user-select: none;
        }
        
        .foot-btn .icon {
            font-size: 24px;
            transition: all 0.3s;
            filter: grayscale(100%);
        }
        
        .foot-btn:hover {
            background: rgba(212,175,55,0.08);
        }
        
        .foot-btn:hover .icon {
            transform: translateY(-4px);
            filter: grayscale(0%);
        }
        
        .foot-btn.active {
            color: var(--gold);
            background: rgba(212,175,55,0.12);
        }
        
        .foot-btn.active .icon {
            filter: grayscale(0%);
            text-shadow: 0 0 12px rgba(212,175,55,0.5);
        }
        
        .foot-btn .badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--red);
            color: #fff;
            font-size: 9px;
            padding: 2px 5px;
            border-radius: 10px;
            font-weight: 700;
        }
        
        /* ========== å³å´å¿«æ·æ¬„ ========== */
        .side-actions {
            position: fixed;
            right: 16px;
            bottom: 76px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 98;
        }
        
        .side-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(212,175,55,0.2), rgba(212,175,55,0.05));
            border: 1.5px solid var(--gold);
            color: var(--gold);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            position: relative;
        }
        
        .side-btn:hover {
            transform: scale(1.12);
            box-shadow: 0 8px 25px rgba(212,175,55,0.3);
        }
        
        /* ========== åŠŸèƒ½é¢æ¿ï¼ˆDrawer & Modalï¼‰========== */
        .panel-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 200;
            backdrop-filter: blur(5px);
        }
        
        .panel-drawer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-height: 80vh;
            background: var(--panel);
            border-top: 1.5px solid var(--border);
            border-radius: 24px 24px 0 0;
            z-index: 201;
            display: flex;
            flex-direction: column;
            animation: slideUpPanel 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
            touch-action: none;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(90deg, rgba(212,175,55,0.08) 0%, rgba(212,175,55,0.03) 100%);
        }
        
        .panel-header h3 {
            flex: 1;
            font-size: 18px;
            color: var(--gold);
            text-align: center;
            font-family: 'Noto Serif TC', serif;
            letter-spacing: 1px;
        }
        
        .panel-close-btn {
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            transition: all 0.3s;
        }
        
        .panel-close-btn:hover {
            color: var(--gold);
            transform: rotate(90deg);
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .panel-drag-handle {
            width: 40px;
            height: 4px;
            background: rgba(212,175,55,0.3);
            border-radius: 2px;
            margin: 8px auto;
        }
        
        /* ========== åŸºåœ°ç®¡ç†ç³»çµ± ========== */
        .base-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border);
            padding: 16px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card .label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 4px;
        }
        
        .stat-card .detail {
            font-size: 10px;
            color: var(--gray);
        }
        
        .base-sections {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .section {
            background: rgba(0,0,0,0.3);
            border-left: 3px solid var(--gold);
            border-radius: 0 10px 10px 0;
            padding: 16px;
        }
        
        .section h4 {
            font-size: 14px;
            color: var(--gold);
            margin-bottom: 12px;
            font-family: 'Noto Serif TC', serif;
            letter-spacing: 1px;
        }
        
        .building-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .building-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(212,175,55,0.2);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .building-item:hover {
            background: rgba(212,175,55,0.1);
            border-color: var(--gold);
        }
        
        .building-info {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .building-icon {
            font-size: 24px;
        }
        
        .building-detail {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .building-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        
        .building-meta {
            font-size: 10px;
            color: var(--gray);
        }
        
        .building-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--gold-dark);
            color: var(--text);
            font-size: 11px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .btn-small:hover {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }
        
        /* ========== Toast æç¤º ========== */
        .toast {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            border: 1.5px solid var(--gold);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 13px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            box-shadow: 0 0 30px rgba(212,175,55,0.3);
        }
        .toast.show { opacity: 1; }
        
        /* ========== éŸ¿æ‡‰å¼è¨­è¨ˆ ========== */
        @media (max-width: 1024px) {
            .game-header { height: 52px; padding: 10px 12px; }
            .res-item { min-width: 70px; }
            .res-item .value { font-size: 16px; }
            .map-grid { grid-template-columns: repeat(5, 1fr); }
            .game-footer { height: 66px; }
            .foot-btn { min-width: 65px; font-size: 9px; }
            .foot-btn .icon { font-size: 20px; }
        }
        
        @media (max-width: 768px) {
            .game-header { height: 48px; padding: 8px 10px; gap: 8px; }
            .res-box { gap: 12px; }
            .res-item { min-width: 60px; }
            .res-item .value { font-size: 14px; }
            .day-box { font-size: 12px; padding: 6px 12px; min-width: 70px; }
            .header-btn { width: 36px; height: 36px; font-size: 16px; }
            .map-grid { grid-template-columns: repeat(4, 1fr); gap: 6px; }
            .map-container { padding: 10px; }
            .game-footer { height: 62px; padding: 6px 8px; }
            .foot-btn { max-width: 60px; font-size: 8px; gap: 2px; padding: 6px 8px; }
            .foot-btn .icon { font-size: 18px; }
            .side-actions { right: 12px; bottom: 70px; }
            .side-btn { width: 50px; height: 50px; font-size: 20px; }
            .panel-drawer { max-height: 90vh; border-radius: 20px 20px 0 0; }
        }
        
        @media (max-width: 480px) {
            .game-header { height: 44px; padding: 6px 8px; gap: 6px; }
            .res-box { gap: 8px; }
            .res-item { min-width: 50px; }
            .res-item .label { font-size: 7px; }
            .res-item .value { font-size: 12px; }
            .day-box { font-size: 11px; padding: 4px 8px; }
            .header-btn { width: 32px; height: 32px; font-size: 14px; }
            .map-grid { grid-template-columns: repeat(3, 1fr); gap: 5px; }
            .grid-cell { min-height: 45px; font-size: 20px; }
            .game-footer { height: 58px; padding: 4px 6px; }
            .foot-btn { max-width: 55px; font-size: 7px; gap: 2px; padding: 4px 6px; }
            .foot-btn .icon { font-size: 16px; }
            .foot-btn .label { display: none; }
            .side-actions { right: 8px; bottom: 64px; }
            .side-btn { width: 44px; height: 44px; font-size: 18px; }
            .panel-drawer { max-height: 95vh; border-radius: 16px 16px 0 0; }
            .base-stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Toast æç¤º -->
    <div id="toast" class="toast"></div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="game-screen">
        <!-- é ‚éƒ¨è³‡æºæ¬„ -->
        <div class="game-header">
            <div class="res-box">
                <div class="res-item">
                    <span class="label">è³‡é‡‘</span>
                    <span class="value" id="res-money">$50,000</span>
                </div>
                <div class="res-item">
                    <span class="label">äººæ‰‹</span>
                    <span class="value" id="res-crew">5</span>
                </div>
                <div class="res-item">
                    <span class="label">è²æœ›</span>
                    <span class="value" id="res-rep">150</span>
                </div>
            </div>
            
            <div class="day-box">
                ç¬¬ <span id="game-day">1</span> å¤©
            </div>
            
            <div class="header-btns">
                <button class="header-btn" onclick="toggleSettings()">âš™ï¸</button>
            </div>
        </div>
        
        <!-- åœ°åœ–å®¹å™¨ -->
        <div class="map-container">
            <div class="map-grid" id="map-grid">
                <!-- ç”± JavaScript ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- åº•éƒ¨åŠŸèƒ½æ¬„ -->
        <div class="game-footer">
            <button class="foot-btn active" data-key="1" onclick="showPanel('base')">
                <span class="icon">ğŸ°</span>
                åŸºåœ°
                <span class="badge">3</span>
            </button>
            <button class="foot-btn" data-key="2" onclick="showPanel('faction')">
                <span class="icon">âš”ï¸</span>
                æ´¾ç³»
                <span class="badge">2</span>
            </button>
            <button class="foot-btn" data-key="3" onclick="showPanel('harem')">
                <span class="icon">ğŸ’ƒ</span>
                å¾Œå®®
            </button>
            <button class="foot-btn" data-key="4" onclick="showPanel('partners')">
                <span class="icon">ğŸ‘¥</span>
                å¤¥ä¼´
            </button>
            <button class="foot-btn" data-key="5" onclick="showPanel('team')">
                <span class="icon">ğŸ¯</span>
                éšŠä¼
            </button>
            <button class="foot-btn" data-key="6" onclick="showPanel('gang')">
                <span class="icon">ğŸ‘‘</span>
                å¹«æœƒ
            </button>
            <button class="foot-btn" data-key="7" onclick="showPanel('world')">
                <span class="icon">ğŸŒ</span>
                ä¸–ç•Œ
                <span class="badge">!</span>
            </button>
            <button class="foot-btn" data-key="8" onclick="showPanel('saves')">
                <span class="icon">ğŸ“</span>
                å­˜æª”
            </button>
            <button class="foot-btn" data-key="9" onclick="showPanel('settings')">
                <span class="icon">âš™ï¸</span>
                è¨­å®š
            </button>
            <button class="foot-btn" data-key="0" onclick="showPanel('help')">
                <span class="icon">â“</span>
                å¹«åŠ©
            </button>
        </div>
        
        <!-- å³å´å¿«æ·æ¬„ -->
        <div class="side-actions">
            <button class="side-btn" onclick="toggleChat()">
                ğŸ’¬
            </button>
            <button class="side-btn" onclick="nextTurn()">
                â­ï¸
            </button>
        </div>
    </div>

    <!-- é¢æ¿é®ç½© -->
    <div id="panel-overlay" class="panel-overlay" onclick="closePanel()"></div>

    <!-- åŸºåœ°ç®¡ç†é¢æ¿ -->
    <div id="base-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸ° åŸºåœ°ç®¡ç†</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            <div class="base-stats">
                <div class="stat-card">
                    <div class="label">åŸºåœ°ç­‰ç´š</div>
                    <div class="value">Lv. 5</div>
                    <div class="detail">å‡ç´šé€²åº¦: 80%</div>
                </div>
                <div class="stat-card">
                    <div class="label">æ—¥ç”¢é‡</div>
                    <div class="value">$8,500</div>
                    <div class="detail">åŸºç¤+ç‰¹æ®Š</div>
                </div>
                <div class="stat-card">
                    <div class="label">é˜²ç¦¦å€¼</div>
                    <div class="value">450</div>
                    <div class="detail">+20 æœ¬é€±</div>
                </div>
                <div class="stat-card">
                    <div class="label">å®¹ç´äººæ•¸</div>
                    <div class="value">45 / 50</div>
                    <div class="detail">è¿‘ä¼¼æ»¿å“¡</div>
                </div>
            </div>
            
            <div class="base-sections">
                <div class="section">
                    <h4>ğŸ¢ è¨­æ–½ç®¡ç†</h4>
                    <div class="building-list">
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">ğŸª</div>
                                <div class="building-detail">
                                    <div class="building-name">ä¾¿åˆ©å•†åº—</div>
                                    <div class="building-meta">Lv.3 | æ”¶ç›Š: $400/å¤©</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small" onclick="upgradeBuilding('shop')">å‡ç´š</button>
                            </div>
                        </div>
                        
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">ğŸ¤</div>
                                <div class="building-detail">
                                    <div class="building-name">KTV</div>
                                    <div class="building-meta">Lv.2 | æ”¶ç›Š: $600/å¤©</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small" onclick="upgradeBuilding('ktv')">å‡ç´š</button>
                            </div>
                        </div>
                        
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">ğŸ¥</div>
                                <div class="building-detail">
                                    <div class="building-name">é†«ç™‚å®¤</div>
                                    <div class="building-meta">Lv.1 | ç‰¹æ®Šå»ºç¯‰</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small" onclick="upgradeBuilding('hospital')">å‡ç´š</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h4>ğŸ‘¥ äººäº‹ç®¡ç†</h4>
                    <div class="building-list">
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">ğŸ“Š</div>
                                <div class="building-detail">
                                    <div class="building-name">å“¡å·¥ç¸½æ•¸</div>
                                    <div class="building-meta">45äºº | å¿ èª åº¦: 78%</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small">æŸ¥çœ‹</button>
                            </div>
                        </div>
                        
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">âš ï¸</div>
                                <div class="building-detail">
                                    <div class="building-name">å¾…é‡èª¿æ•´</div>
                                    <div class="building-meta">3äºº | ä½æ–¼å¹³å‡</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small">è™•ç†</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h4>ğŸ›¡ï¸ é˜²ç¦¦æªæ–½</h4>
                    <div class="building-list">
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">ğŸš¨</div>
                                <div class="building-detail">
                                    <div class="building-name">è­¦å ±ç³»çµ±</div>
                                    <div class="building-meta">Lv.2 | å·²å•Ÿç”¨</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small">è¨­å®š</button>
                            </div>
                        </div>
                        
                        <div class="building-item">
                            <div class="building-info">
                                <div class="building-icon">ğŸ”</div>
                                <div class="building-detail">
                                    <div class="building-name">å®‰å…¨é˜²è¡›</div>
                                    <div class="building-meta">ä¸‹æ¬¡æª¢ä¿®: 3å¤©å¾Œ</div>
                                </div>
                            </div>
                            <div class="building-actions">
                                <button class="btn-small">ç¶­è­·</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ´¾ç³»é¢æ¿ -->
    <div id="faction-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>âš”ï¸ æ´¾ç³»</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            æ´¾ç³»åŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- å¾Œå®®é¢æ¿ -->
    <div id="harem-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸ’ƒ å¾Œå®®</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content" id="harem-content">
            å¾Œå®®åŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- å¤¥ä¼´é¢æ¿ -->
    <div id="partners-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸ‘¥ å¤¥ä¼´</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content" id="partners-grid">
            å¤¥ä¼´åŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- éšŠä¼é¢æ¿ -->
    <div id="team-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸ¯ éšŠä¼</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            éšŠä¼åŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- å¹«æœƒé¢æ¿ -->
    <div id="gang-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸ‘‘ å¹«æœƒ</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            å¹«æœƒåŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- ä¸–ç•Œé¢æ¿ -->
    <div id="world-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸŒ ä¸–ç•Œ</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            ä¸–ç•ŒåŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- å­˜æª”é¢æ¿ -->
    <div id="saves-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>ğŸ“ å­˜æª”</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            å­˜æª”åŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- è¨­å®šé¢æ¿ -->
    <div id="settings-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>âš™ï¸ è¨­å®š</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <!-- å¹«åŠ©é¢æ¿ -->
    <div id="help-panel" class="panel-drawer" style="display:none;">
        <div class="panel-drag-handle"></div>
        <div class="panel-header">
            <h3>â“ å¹«åŠ©</h3>
            <button class="panel-close-btn" onclick="closePanel()">âœ•</button>
        </div>
        <div class="panel-content">
            å¹«åŠ©åŠŸèƒ½é–‹ç™¼ä¸­...
        </div>
    </div>

    <script>
// ========== ç³»çµ±è®Šæ•¸ ==========
let currentPanel = null;

const gameData = {
    money: 50000,
    crew: 5,
    reputation: 150,
    day: 1,
    grid: []
};

// å»ºç¯‰é¡å‹
const buildingTypes = {
    'hq': { icon: 'ğŸ°', name: 'ç¸½éƒ¨', lv: 1 },
    'shop': { icon: 'ğŸª', name: 'ä¾¿åˆ©å•†åº—', lv: 3 },
    'ktv': { icon: 'ğŸ¤', name: 'KTV', lv: 2 },
    'hospital': { icon: 'ğŸ¥', name: 'é†«ç™‚å®¤', lv: 1 },
};

// ========== Toast ç³»çµ± ==========
function showToast(msg) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2500);
}

// ========== é¢æ¿æ§åˆ¶ ==========
function showPanel(panelName) {
    closePanel();
    
    currentPanel = panelName;
    
    const overlay = document.getElementById('panel-overlay');
    const panel = document.getElementById(panelName + '-panel');
    
    overlay.style.display = 'block';
    if (panel) {
        panel.style.display = 'flex';
    }
    
    // æ¨™è¨˜æ´»èºæŒ‰éˆ•
    document.querySelectorAll('.foot-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-key="${getPanelKey(panelName)}"]`)?.classList.add('active');
}

function getPanelKey(panelName) {
    const keys = {
        'base': '1',
        'faction': '2',
        'harem': '3',
        'partners': '4',
        'team': '5',
        'gang': '6',
        'world': '7',
        'saves': '8',
        'settings': '9',
        'help': '0'
    };
    return keys[panelName] || '';
}

function closePanel() {
    const overlay = document.getElementById('panel-overlay');
    const panels = document.querySelectorAll('.panel-drawer');
    
    overlay.style.display = 'none';
    panels.forEach(p => p.style.display = 'none');
    
    document.querySelectorAll('.foot-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    currentPanel = null;
}

// æ‹–å‹•é—œé–‰é¢æ¿ï¼ˆæ‰‹æ©Ÿï¼‰
let touchStartY = 0;
document.addEventListener('touchstart', (e) => {
    const drawer = document.querySelector('.panel-drawer[style*="flex"]');
    if (drawer) touchStartY = e.touches[0].clientY;
});

document.addEventListener('touchmove', (e) => {
    const drawer = document.querySelector('.panel-drawer[style*="flex"]');
    if (!drawer) return;
    
    const touchY = e.touches[0].clientY;
    const diff = touchY - touchStartY;
    
    if (diff > 50) {
        closePanel();
    }
});

// ========== éŠæˆ²é‚è¼¯ ==========
function initGame() {
    // ç”Ÿæˆ 6Ã—6 åœ°åœ–
    for (let i = 0; i < 36; i++) {
        const cell = { type: 'empty', lv: 0 };
        
        if (i === 9) { // ä¸­å¿ƒè¨­ç‚ºç¸½éƒ¨
            cell.type = 'hq';
            cell.lv = 1;
        } else if (i === 1) {
            cell.type = 'shop';
            cell.lv = 3;
        } else if (i === 13) {
            cell.type = 'ktv';
            cell.lv = 2;
        } else if (i === 12) {
            cell.type = 'hospital';
            cell.lv = 1;
        }
        
        gameData.grid.push(cell);
    }
    
    renderMap();
}

function renderMap() {
    const grid = document.getElementById('map-grid');
    grid.innerHTML = gameData.grid.map((cell, i) => {
        const building = buildingTypes[cell.type];
        const icon = building ? building.icon : 'â¬œ';
        return `
            <div class="grid-cell ${cell.type === 'hq' ? 'hq' : ''}" onclick="clickCell(${i})">
                ${icon}
                ${cell.lv > 0 ? `<div class="lv">Lv.${cell.lv}</div>` : ''}
            </div>
        `;
    }).join('');
}

function clickCell(index) {
    showToast(`é»æ“Šæ ¼å­ #${index}`);
}

function nextTurn() {
    gameData.day++;
    gameData.money += 5000;
    gameData.reputation += 5;
    updateHeader();
    showToast(`é€²å…¥ç¬¬ ${gameData.day} å¤© | +$5,000`);
}

function updateHeader() {
    document.getElementById('res-money').textContent = `$${gameData.money.toLocaleString()}`;
    document.getElementById('res-crew').textContent = gameData.crew;
    document.getElementById('res-rep').textContent = gameData.reputation;
    document.getElementById('game-day').textContent = gameData.day;
}

function toggleChat() {
    showToast('èŠå¤©åŠŸèƒ½é–‹ç™¼ä¸­...');
}

function toggleSettings() {
    showPanel('settings');
}

function upgradeBuilding(type) {
    showToast(`å‡ç´š ${buildingTypes[type]?.name || 'è¨­æ–½'} ä¸­...`);
}

// ========== éµç›¤å¿«æ·éµ ==========
document.addEventListener('keydown', (e) => {
    // æ•¸å­—éµ 1-9, 0
    if (e.key >= '0' && e.key <= '9') {
        const panels = ['help', 'base', 'faction', 'harem', 'partners', 'team', 'gang', 'world', 'saves', 'settings'];
        const panelName = panels[parseInt(e.key)];
        if (panelName) showPanel(panelName);
    }
    
    // ESC é—œé–‰é¢æ¿
    if (e.key === 'Escape') {
        closePanel();
    }
    
    // M æ‰“é–‹èŠå¤©
    if (e.key === 'm' || e.key === 'M') {
        toggleChat();
    }
    
    // N ä¸‹ä¸€å›åˆ
    if (e.key === 'n' || e.key === 'N') {
        nextTurn();
    }
});

// ========== åˆå§‹åŒ– ==========
document.addEventListener('DOMContentLoaded', () => {
    initGame();
});
    </script>
</body>
</html>
