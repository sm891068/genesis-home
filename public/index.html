<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘é“å»ºç¯‰ Underworld Architect</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --gold: #d4af37;
            --gold-light: #f4d03f;
            --gold-dark: #b8941f;
            --gold-glow: rgba(212, 175, 55, 0.3);
            --red: #ff2e63;
            --blue: #3498db;
            --bg: #0a0e27;
            --bg-light: #151a35;
            --panel: rgba(10, 14, 39, 0.98);
            --text: #e8e8e8;
            --gray: #888;
            --border: rgba(212, 175, 55, 0.2);
        }
        
        body {
            font-family: 'Noto Serif TC', serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* ========== ä¸‹é›¨å‹•ç•« ========== */
        .rain {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .raindrop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(transparent, rgba(212, 175, 55, 0.3));
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        
        /* ========== ä¸»é¸å–®å®¹å™¨ ========== */
        #main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            position: relative;
            z-index: 10;
            background: radial-gradient(ellipse at center, rgba(212,175,55,0.05) 0%, transparent 70%);
        }
        
        .logo {
            font-size: 48px;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 0 0 30px var(--gold-glow), 0 0 60px var(--gold-glow);
            margin-bottom: 20px;
            animation: glow 3s ease-in-out infinite;
            font-family: 'Noto Serif TC', serif;
            letter-spacing: 4px;
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 30px var(--gold-glow), 0 0 60px var(--gold-glow); }
            50% { text-shadow: 0 0 40px var(--gold-glow), 0 0 80px var(--gold-glow), 0 0 100px rgba(212,175,55,0.1); }
        }
        
        .subtitle {
            font-size: 18px;
            color: var(--gray);
            margin-bottom: 60px;
            letter-spacing: 2px;
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 320px;
        }
        
        .menu-btn {
            padding: 18px 40px;
            background: linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.05));
            border: 2px solid var(--gold-dark);
            color: var(--text);
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s;
            font-family: 'Noto Serif TC', serif;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .menu-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(212,175,55,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        
        .menu-btn:hover::before {
            transform: translateX(100%);
        }
        
        .menu-btn:hover {
            background: linear-gradient(135deg, rgba(212,175,55,0.3), rgba(212,175,55,0.1));
            border-color: var(--gold);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212,175,55,0.3);
        }
        
        .menu-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: rgba(255,255,255,0.05);
            border-color: var(--gray);
        }
        
        .menu-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .footer-info {
            position: fixed;
            bottom: 20px;
            text-align: center;
            width: 100%;
            font-size: 12px;
            color: var(--gray);
            z-index: 10;
        }
        
        /* ========== Toast æ¨£å¼ ========== */
        .toast {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            border: 1.5px solid var(--gold);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            box-shadow: 0 0 30px var(--gold-glow);
        }
        
        .toast.show { opacity: 1; }
        
        .toast.success { border-color: #27ae60; }
        .toast.error { border-color: #e74c3c; }
        .toast.warning { border-color: #f39c12; }
        
        /* ========== éŸ¿æ‡‰å¼è¨­è¨ˆ ========== */
        @media (max-width: 768px) {
            .logo { font-size: 36px; }
            .subtitle { font-size: 14px; margin-bottom: 40px; }
            .menu-buttons { min-width: 280px; gap: 12px; }
            .menu-btn { padding: 16px 32px; font-size: 16px; }
        }
        
        @media (max-width: 480px) {
            .logo { font-size: 28px; }
            .subtitle { font-size: 12px; margin-bottom: 30px; }
            .menu-buttons { min-width: 240px; gap: 10px; }
            .menu-btn { padding: 14px 28px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <!-- ä¸‹é›¨å‹•ç•«å®¹å™¨ -->
    <div class="rain" id="rain"></div>

    <!-- Toast æç¤º -->
    <div id="toast" class="toast"></div>

    <!-- ä¸»é¸å–® -->
    <div id="main-menu">
        <div class="logo">é»‘é“å»ºç¯‰</div>
        <div class="subtitle">UNDERWORLD ARCHITECT</div>
        
        <div class="menu-buttons">
            <button class="menu-btn" onclick="menuController.newGame()">
                ğŸ†• æ–°çš„å‚³æ‰¿
            </button>
            <button class="menu-btn" id="continue-btn" onclick="menuController.continueGame()" disabled>
                â–¶ï¸ ç¹¼çºŒéŠæˆ²
            </button>
            <button class="menu-btn" onclick="menuController.showGloryHall()">
                ğŸ‘‘ æ¦®è€€æ®¿å ‚
            </button>
            <button class="menu-btn" onclick="menuController.showAchievements()">
                ğŸ† æˆå°±æ®¿å ‚
            </button>
            <button class="menu-btn" onclick="menuController.showPartnerGallery()">
                ğŸ“– å¤¥ä¼´åœ–é‘‘
            </button>
            <button class="menu-btn" onclick="menuController.showDiary()">
                ğŸ“” é»‘é“æ—¥èªŒ
            </button>
            <button class="menu-btn" onclick="menuController.showOfficeSettings()">
                ğŸ¢ è¾¦å…¬å®¤è¨­å®š
            </button>
        </div>
        
        <div class="footer-info">
            Version 1.0.0 | Made with â¤ï¸ by Your Studio
        </div>
    </div>

    <!-- çˆ¶è¦ªå°è©±ç•«é¢ -->
    <div id="father-dialogue" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; padding: 40px;">
        <div style="display: flex; align-items: center; justify-content: center; flex-direction: column; height: 100%;">
        <div style="max-width: 800px; text-align: center;">
            <div style="font-size: 60px; margin-bottom: 20px;">ğŸ‘”</div>
            <h2 style="color: var(--gold); font-size: 32px; margin-bottom: 30px;">é¾çˆºçš„éºè¨€</h2>
            <div id="dialogue-text" style="font-size: 20px; line-height: 2; color: var(--text); min-height: 200px; padding: 30px; background: rgba(212,175,55,0.1); border: 2px solid var(--border); border-radius: 10px;">
            </div>
            <div id="dialogue-timer" style="margin-top: 20px; color: var(--gray); font-size: 16px;"></div>
        </div>
        </div>
    </div>

    <!-- æ•´åˆç•«é¢ï¼šè·¯ç·šé¸æ“‡ + å‘½å -->
    <div id="route-selection" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 1400px; margin: 0 auto;">
            <h2 style="color: var(--gold); font-size: clamp(24px, 5vw, 36px); text-align: center; margin-bottom: 10px;">é¸æ“‡ä½ çš„é“è·¯</h2>
            <p style="text-align: center; color: var(--gray); margin-bottom: 30px; font-size: clamp(14px, 3vw, 16px);">5æ¢è·¯ç·šï¼Œä¸åŒçš„å‚³å¥‡</p>
            
            <!-- è·¯ç·šç¶²æ ¼ï¼šéŸ¿æ‡‰å¼ 2x3 ä½ˆå±€ï¼ˆç¸®å°10%ï¼‰-->
            <div id="routes-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(min(252px, 100%), 1fr)); gap: 13px; margin-bottom: 27px; max-width: 1080px; margin-left: auto; margin-right: auto;">
                <!-- è·¯ç·šå¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
            </div>
            
            <!-- å‘½åè¡¨å–®å€ -->
            <div style="background: var(--panel); border: 2px solid var(--gold); border-radius: 12px; padding: clamp(20px, 4vw, 40px); max-width: 600px; margin: 0 auto 20px;">
                <h3 style="color: var(--gold); font-size: clamp(20px, 4vw, 28px); text-align: center; margin-bottom: 20px;">å»ºç«‹ä½ çš„å¸åœ‹</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; color: var(--text); margin-bottom: 8px; font-size: clamp(14px, 2.5vw, 16px);">å¹«æ´¾åç¨±</label>
                        <input id="gang-name-input" type="text" placeholder="é¾é–€å¹«" maxlength="8" style="width: 100%; padding: 12px; font-size: clamp(16px, 3vw, 18px); text-align: center; background: rgba(255,255,255,0.1); border: 2px solid var(--border); color: var(--text); border-radius: 8px;" />
                    </div>
                    <div>
                        <label style="display: block; color: var(--text); margin-bottom: 8px; font-size: clamp(14px, 2.5vw, 16px);">ä½ çš„ç¨±è™Ÿ</label>
                        <input id="player-name-input" type="text" placeholder="è€å¤§" maxlength="6" style="width: 100%; padding: 12px; font-size: clamp(16px, 3vw, 18px); text-align: center; background: rgba(255,255,255,0.1); border: 2px solid var(--border); color: var(--text); border-radius: 8px;" />
                    </div>
                </div>
                
                <div id="selected-route-display" style="text-align: center; color: var(--gray); font-size: clamp(13px, 2.5vw, 15px); margin-bottom: 15px; min-height: 24px;">
                    è«‹å…ˆé¸æ“‡è·¯ç·š
                </div>
                
                <button id="confirm-start-btn" onclick="menuController.confirmStart()" disabled style="width: 100%; padding: clamp(14px, 3vw, 18px); background: linear-gradient(135deg, var(--gold), var(--gold-dark)); border: none; color: #000; font-size: clamp(18px, 3.5vw, 22px); font-weight: bold; cursor: not-allowed; border-radius: 8px; transition: all 0.3s; box-shadow: 0 4px 15px var(--gold-glow); opacity: 0.5;">
                    é–‹å§‹å‚³æ‰¿ ğŸ¯
                </button>
            </div>
            
            <div style="text-align: center;">
                <button onclick="menuController.cancelRouteSelection()" style="padding: clamp(10px, 2vw, 15px) clamp(30px, 5vw, 40px); background: rgba(255,255,255,0.1); border: 2px solid var(--border); color: var(--text); font-size: clamp(14px, 2.5vw, 16px); cursor: pointer; border-radius: 8px; transition: all 0.3s;">
                    â† è¿”å›ä¸»é¸å–®
                </button>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥æ ¸å¿ƒè…³æœ¬ -->
    <script src="/static/core/game-state.js"></script>
    <script src="/static/ui/shared-ui.js"></script>
    <script src="/static/routes-data.js"></script>
    <script src="/static/partner-data.js"></script>
    <script src="/static/data/ai-personality.js"></script>
    <script src="/static/data/ai-character-logic.js"></script>

    <script>
    // ========== ä¸»é¸å–®æ§åˆ¶å™¨ ==========
    const menuController = {
        selectedRoute: null,
        
        init() {
            console.log('[MainMenu] åˆå§‹åŒ–ä¸»é¸å–®');
            
            // æª¢æŸ¥æ˜¯å¦æœ‰å­˜æª”
            this.updateContinueButton();
            
            // åˆå§‹åŒ–ä¸‹é›¨å‹•ç•«
            this.initRain();
        },

        // æ›´æ–°ç¹¼çºŒæŒ‰éˆ•ç‹€æ…‹
        updateContinueButton() {
            const btn = document.getElementById('continue-btn');
            const latestSave = GameState.getLatestSave();
            
            if (latestSave) {
                btn.disabled = false;
                btn.textContent = `â–¶ï¸ ç¹¼çºŒéŠæˆ² (Day ${latestSave.day})`;
            } else {
                btn.disabled = true;
                btn.textContent = 'â–¶ï¸ ç¹¼çºŒéŠæˆ²';
            }
        },

        // æ–°éŠæˆ² - å•Ÿå‹•çˆ¶è¦ªå°è©±
        newGame() {
            this.showFatherDialogue();
        },

        // é¡¯ç¤ºçˆ¶è¦ªå°è©±ï¼ˆ14ç§’ï¼‰
        showFatherDialogue() {
            const dialogue = document.getElementById('father-dialogue');
            const dialogueText = document.getElementById('dialogue-text');
            const timer = document.getElementById('dialogue-timer');
            const mainMenu = document.getElementById('main-menu');
            
            // éš±è—ä¸»é¸å–®
            mainMenu.style.display = 'none';
            dialogue.style.display = 'block';
            
            // çˆ¶è¦ªçš„éºè¨€ï¼ˆæ“´å……åŠ‡æƒ…ç‰ˆï¼‰
            const messages = [
                'å­©å­ï¼Œå¦‚æœä½ çœ‹åˆ°é€™æ®µå½±ç‰‡ï¼Œä»£è¡¨æˆ‘å·²ç¶“ä¸åœ¨äº†...',
                'é€™å€‹åŸå¸‚å¾ˆæ®˜é…·ï¼Œæˆ‘åœ¨é€™æ¢è·¯ä¸Šèµ°äº†ä¸‰åå¹´ï¼Œè¦‹è­‰äº†ç„¡æ•¸çš„ç”Ÿæ­»ã€‚',
                'è¨˜ä½ï¼Œåšäººè¦æœ‰åº•ç·šã€‚åˆ¥ç¢°æ¯’å“ï¼Œé‚£æ˜¯åº•ç·šã€‚',
                'éŒ¢å¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯ä¸€åˆ‡ã€‚éŒ¢èƒ½è§£æ±ºçš„ï¼Œéƒ½ä¸æ˜¯å•é¡Œã€‚',
                'çœŸæ­£çš„è€å¤§ï¼Œé çš„æ˜¯å°Šé‡è€Œéææ‡¼ã€‚é€™åŸå¸‚ï¼Œå°Šé‡æ¯”ææ‡¼æ›´é‡è¦ã€‚',
                'æˆ‘çŸ¥é“ä½ å–œæ­¡æ¼‚äº®å§‘å¨˜ï¼Œæœ‰ç¾äººï¼Œè¨˜å¾—å¸¶å›å®¶çµ¦ä½ åª½çœ‹çœ‹ã€‚',
                'æ±Ÿæ¹–ä¸Šï¼Œæ‹³é ­æ˜¯ç¡¬é“ç†ï¼Œä½†è…¦å­æ›´é‡è¦ã€‚æ‡‚å¾—ç”¨è…¦æ‰èƒ½æ´»å¾—é•·ä¹…ã€‚',
                'æˆ‘ç•™çµ¦ä½ çš„ï¼Œä¸åªæ˜¯é€™å€‹å¹«æ´¾ï¼Œé‚„æœ‰æˆ‘çš„ä¿¡å¿µå’Œä¸‰åå¹´çš„äººè„ˆã€‚',
                'æˆ‘ç‚ºä½ æº–å‚™äº†ä¸€å€‹å¯é çš„å¼•å°è€…ï¼Œä»–æœƒåœ¨ä½ æœ€éœ€è¦çš„æ™‚å€™å‡ºç¾ã€‚',
                'ç„¡è«–ä½ é¸æ“‡å“ªæ¢è·¯ï¼Œéƒ½è¦è¨˜ä½ï¼Œå®¶äººæ°¸é æ˜¯æœ€é‡è¦çš„ã€‚',
                'ç¾åœ¨ï¼Œé¸æ“‡ä½ è‡ªå·±çš„é“è·¯å§...èµ°å‡ºå±¬æ–¼ä½ çš„å‚³å¥‡ã€‚',
                'è¨˜ä½ï¼Œçˆ¸çˆ¸æ°¸é ä»¥ä½ ç‚ºæ¦®ã€‚é¡˜ä½ å¹³å®‰ï¼Œé¡˜ä½ å¼·å¤§ã€‚'
            ];
            
            let currentIndex = 0;
            let timeLeft = 14;
            
            // æ›´æ–°å°è©±å…§å®¹
            const updateDialogue = () => {
                if (currentIndex < messages.length) {
                    dialogueText.textContent = messages[currentIndex];
                    currentIndex++;
                }
            };
            
            // åˆå§‹é¡¯ç¤º
            updateDialogue();
            
            // æ¯1.15ç§’æ›ä¸€å¥ï¼ˆ12å¥ Ã— 1.15ç§’ â‰ˆ 14ç§’ï¼‰
            const dialogueInterval = setInterval(updateDialogue, 1150);
            
            // å€’è¨ˆæ™‚
            const countdownInterval = setInterval(() => {
                timeLeft--;
                timer.textContent = `${timeLeft} ç§’å¾Œé€²å…¥è·¯ç·šé¸æ“‡...`;
                
                if (timeLeft <= 0) {
                    clearInterval(dialogueInterval);
                    clearInterval(countdownInterval);
                    
                    // é€²å…¥è·¯ç·šé¸æ“‡
                    dialogue.style.display = 'none';
                    this.showRouteSelection();
                }
            }, 1000);
        },

        // é¡¯ç¤ºè·¯ç·šé¸æ“‡ï¼ˆæ•´åˆç‰ˆï¼‰
        showRouteSelection() {
            const routeSelection = document.getElementById('route-selection');
            const container = document.getElementById('routes-container');
            
            routeSelection.style.display = 'block';
            
            // ç”Ÿæˆè·¯ç·šå¡ç‰‡
            container.innerHTML = '';
            Object.values(ROUTES_DATA).forEach(route => {
                const card = this.createRouteCard(route);
                container.appendChild(card);
            });
            
            // é‡ç½®é¸æ“‡ç‹€æ…‹
            this.selectedRoute = null;
            this.updateStartButton();
        },

        // å‰µå»ºè·¯ç·šå¡ç‰‡ï¼ˆç·Šæ¹Šç‰ˆï¼‰
        createRouteCard(route) {
            const card = document.createElement('div');
            card.className = 'route-card';
            card.dataset.routeId = route.id;
            card.style.cssText = `
                background: linear-gradient(135deg, ${route.color}20, ${route.color}05);
                border: 3px solid ${route.color};
                border-radius: 10px;
                padding: clamp(13px, 2.7vw, 18px);
                cursor: pointer;
                transition: all 0.3s;
                position: relative;
                overflow: hidden;
                min-height: 180px;
            `;
            
            card.innerHTML = `
                <div style="font-size: clamp(29px, 7.2vw, 36px); text-align: center; margin-bottom: 9px;">${route.icon}</div>
                <h3 style="color: ${route.color}; font-size: clamp(16px, 3.6vw, 20px); text-align: center; margin-bottom: 7px; font-weight: bold;">${route.name}</h3>
                <p style="color: var(--gray); text-align: center; font-style: italic; margin-bottom: 11px; font-size: clamp(11px, 2.25vw, 13px); line-height: 1.4;">${route.subtitle}</p>
                
                <div style="background: rgba(0,0,0,0.3); padding: clamp(7px, 1.8vw, 11px); border-radius: 5px; margin-bottom: 9px;">
                    <div style="color: var(--text); font-size: clamp(10px, 1.8vw, 12px); line-height: 1.5; text-align: center;">
                        ğŸ’° ${(route.bonuses.money / 1000).toFixed(0)}K | 
                        ğŸ–ï¸ ${route.bonuses.reputation} | 
                        ğŸ‘¥ ${route.bonuses.crew}
                    </div>
                </div>
                
                <div class="route-selected-mark" style="display: none; position: absolute; top: 9px; right: 9px; background: ${route.color}; color: #fff; padding: 4px 9px; border-radius: 18px; font-size: 11px; font-weight: bold;">
                    âœ“ å·²é¸
                </div>
            `;
            
            // æ‡¸åœæ•ˆæœ
            card.addEventListener('mouseenter', () => {
                if (!card.classList.contains('selected')) {
                    card.style.transform = 'translateY(-5px)';
                    card.style.boxShadow = `0 10px 30px ${route.color}60`;
                }
            });
            
            card.addEventListener('mouseleave', () => {
                if (!card.classList.contains('selected')) {
                    card.style.transform = 'translateY(0)';
                    card.style.boxShadow = 'none';
                }
            });
            
            // é»æ“Šé¸æ“‡è·¯ç·š
            card.addEventListener('click', () => {
                this.selectRoute(route.id, card);
            });
            
            return card;
        },

        // é¸æ“‡è·¯ç·šï¼ˆæ•´åˆç‰ˆï¼‰
        selectRoute(routeId, cardElement) {
            this.selectedRoute = routeId;
            const route = ROUTES_DATA[routeId];
            
            // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.route-card').forEach(c => {
                c.classList.remove('selected');
                c.style.borderWidth = '3px';
                c.style.transform = 'translateY(0)';
                c.querySelector('.route-selected-mark').style.display = 'none';
            });
            
            // æ¨™è¨˜ç•¶å‰é¸ä¸­çš„å¡ç‰‡
            cardElement.classList.add('selected');
            cardElement.style.borderWidth = '5px';
            cardElement.style.boxShadow = `0 0 30px ${route.color}80`;
            cardElement.querySelector('.route-selected-mark').style.display = 'block';
            
            // æ›´æ–°é¸ä¸­é¡¯ç¤º
            document.getElementById('selected-route-display').innerHTML = `
                å·²é¸æ“‡ï¼š<span style="color: ${route.color}; font-weight: bold;">${route.icon} ${route.name}</span>
            `;
            
            // å•Ÿç”¨é–‹å§‹æŒ‰éˆ•
            this.updateStartButton();
        },
        
        // æ›´æ–°é–‹å§‹æŒ‰éˆ•ç‹€æ…‹
        updateStartButton() {
            const btn = document.getElementById('confirm-start-btn');
            if (this.selectedRoute) {
                btn.disabled = false;
                btn.style.cursor = 'pointer';
                btn.style.opacity = '1';
            } else {
                btn.disabled = true;
                btn.style.cursor = 'not-allowed';
                btn.style.opacity = '0.5';
            }
        },
        
        // ç¢ºèªé–‹å§‹éŠæˆ²ï¼ˆæ•´åˆç‰ˆï¼‰
        confirmStart() {
            if (!this.selectedRoute) {
                Toast.error('è«‹å…ˆé¸æ“‡ä¸€æ¢è·¯ç·š');
                return;
            }
            
            const gangName = document.getElementById('gang-name-input').value.trim();
            const playerName = document.getElementById('player-name-input').value.trim();
            
            if (!gangName || gangName.length < 2) {
                Toast.error('è«‹è¼¸å…¥å¹«æ´¾åç¨±ï¼ˆè‡³å°‘2å€‹å­—ï¼‰');
                document.getElementById('gang-name-input').focus();
                return;
            }
            
            if (!playerName || playerName.length < 2) {
                Toast.error('è«‹è¼¸å…¥ä½ çš„ç¨±è™Ÿï¼ˆè‡³å°‘2å€‹å­—ï¼‰');
                document.getElementById('player-name-input').focus();
                return;
            }
            
            // é¡¯ç¤ºè¼‰å…¥ç•«é¢
            LoadingScreen.show('å‰µå»ºä½ çš„å¸åœ‹...');
            
            setTimeout(() => {
                const success = GameState.newGame(this.selectedRoute, gangName, playerName);
                
                if (success) {
                    LoadingScreen.hide();
                    Toast.success(`æ­¡è¿ï¼Œ${playerName}ï¼${gangName}æ­£å¼æˆç«‹ï¼`);
                    
                    // è·³è½‰åˆ°éŠæˆ²ç•«é¢
                    setTimeout(() => {
                        window.location.href = '/game-main.html';
                    }, 1500);
                } else {
                    LoadingScreen.hide();
                    Toast.error('éŠæˆ²åˆå§‹åŒ–å¤±æ•—');
                }
            }, 2000);
        },

        // ç¢ºèªå‘½åä¸¦é–‹å§‹éŠæˆ²
        // å–æ¶ˆè·¯ç·šé¸æ“‡
        cancelRouteSelection() {
            document.getElementById('route-selection').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        },

        // ç¹¼çºŒéŠæˆ²
        continueGame() {
            const latestSave = GameState.getLatestSave();
            
            if (!latestSave) {
                Toast.error('æ‰¾ä¸åˆ°å­˜æª”');
                return;
            }

            LoadingScreen.show('è¼‰å…¥å­˜æª”ä¸­...');
            
            setTimeout(() => {
                const success = GameState.load(latestSave.id);
                
                if (success) {
                    LoadingScreen.hide();
                    Toast.success('å­˜æª”è¼‰å…¥æˆåŠŸï¼');
                    
                    // è·³è½‰åˆ°éŠæˆ²ç•«é¢
                    setTimeout(() => {
                        window.location.href = '/game-main.html';
                    }, 800);
                } else {
                    LoadingScreen.hide();
                    Toast.error('å­˜æª”è¼‰å…¥å¤±æ•—');
                }
            }, 1500);
        },

        // é¡¯ç¤ºå¤¥ä¼´åœ–é‘‘
        showPartnerGallery() {
            Toast.show('å¤¥ä¼´åœ–é‘‘åŠŸèƒ½é–‹ç™¼ä¸­...', 2000);
            // TODO: é¡¯ç¤ºå¤¥ä¼´åœ–é‘‘ç•«é¢
        },

        // é¡¯ç¤ºæ¦®è€€æ®¿å ‚
        showGloryHall() {
            Toast.show('æ¦®è€€æ®¿å ‚åŠŸèƒ½é–‹ç™¼ä¸­...', 2000);
            // TODO: é¡¯ç¤ºæ¦®è€€æ®¿å ‚ç•«é¢
        },

        // é¡¯ç¤ºæˆå°±æ®¿å ‚
        showAchievements() {
            Toast.show('æˆå°±æ®¿å ‚åŠŸèƒ½é–‹ç™¼ä¸­...', 2000);
            // TODO: é¡¯ç¤ºæˆå°±æ®¿å ‚ç•«é¢
        },

        // é¡¯ç¤ºé»‘é“æ—¥èªŒ
        showDiary() {
            Toast.show('é»‘é“æ—¥èªŒåŠŸèƒ½é–‹ç™¼ä¸­...', 2000);
            // TODO: é¡¯ç¤ºé»‘é“æ—¥èªŒç•«é¢
        },

        // é¡¯ç¤ºè¾¦å…¬å®¤è¨­å®š
        showOfficeSettings() {
            Toast.show('è¾¦å…¬å®¤è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...', 2000);
            // TODO: é¡¯ç¤ºè¾¦å…¬å®¤è¨­å®šç•«é¢
        },

        // åˆå§‹åŒ–ä¸‹é›¨å‹•ç•«
        initRain() {
            const rainContainer = document.getElementById('rain');
            const dropCount = 100; // é›¨æ»´æ•¸é‡

            for (let i = 0; i < dropCount; i++) {
                const drop = document.createElement('div');
                drop.className = 'raindrop';
                
                // éš¨æ©Ÿä½ç½®
                drop.style.left = Math.random() * 100 + '%';
                
                // éš¨æ©Ÿå»¶é²
                drop.style.animationDelay = Math.random() * 2 + 's';
                
                // éš¨æ©ŸæŒçºŒæ™‚é–“
                drop.style.animationDuration = (Math.random() * 1 + 1) + 's';
                
                // éš¨æ©Ÿé€æ˜åº¦
                drop.style.opacity = Math.random() * 0.5 + 0.3;
                
                rainContainer.appendChild(drop);
            }
        }
    };

    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        menuController.init();
    });
    </script>
</body>
</html>
